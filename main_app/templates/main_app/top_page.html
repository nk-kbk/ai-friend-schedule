{% extends "main_app/base.html" %}
{% load static %}

{% block title %}ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - AIãƒ•ãƒ¬ãƒ³ãƒ‰ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«{% endblock %}

{% block head_extra_css %}
<style>
    /* ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å›ºæœ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .dashboard-container {
        /* grid-template-columns ã¯ Tailwindã‚¯ãƒ©ã‚¹ã§æŒ‡å®š */
        gap: 1.5rem; /* Tailwindã® gap-6 ç›¸å½“ */
    }
    .welcome-banner {
      background: linear-gradient(135deg, #60a5fa, #3b82f6); /* Tailwindã®sky-400ã‹ã‚‰blue-500ã¸ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ (ä»®) */
      background-size: cover;
      background-position: center;
      animation: fadeInAnimation 0.5s ease-out;
    }
    .card-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08); /* Tailwindã® shadow-lg ç›¸å½“ */
    }
    .ai-avatar-float {
      animation: floatAnimation 3s ease-in-out infinite;
    }
    @keyframes fadeInAnimation {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes floatAnimation {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }
    
    /* å³å´ã®äºˆå®šä¸€è¦§ã‚¨ãƒªã‚¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    /* âœ¨ ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆï¼ é«˜ã•ãŒå›ºå®šã•ã‚Œã¦ã‚‹ã¨ã€äºˆå®šãŒå¤šã„æ™‚ã«è¦‹åˆ‡ã‚Œã¡ã‚ƒã†ã‹ã‚‰ã€max-heightã«ã™ã‚‹ã­ï¼ âœ¨ */
    .daily-schedule-list { 
        max-height: 20rem; /* ç´„320px */
        overflow-y: auto; 
    }
    
    /* âœ¨ ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆï¼ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ã¡ã‚‡ã£ã¨ã ã‘å¯æ„›ãã™ã‚‹ã‚ˆï¼ˆãŠã¾ã‘ï¼‰âœ¨ */
    .daily-schedule-list::-webkit-scrollbar {
        width: 6px;
    }
    .daily-schedule-list::-webkit-scrollbar-track {
        background: #f1f5f9; /* slate-100 */
        border-radius: 3px;
    }
    .daily-schedule-list::-webkit-scrollbar-thumb {
        background: #94a3b8; /* slate-400 */
        border-radius: 3px;
    }
    .daily-schedule-list::-webkit-scrollbar-thumb:hover {
        background: #64748b; /* slate-500 */
    }
</style>
{% endblock %}

{% block content %}
<div class="p-6 md:p-10">
    <div class="max-w-7xl mx-auto"> {# å…¨ä½“ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’å°‘ã—åºƒã‚ã«ã—ã¦ã¿ã‚‹ã­ #}
        {# --- ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒãƒŠãƒ¼ --- #}
        <section class="mb-8 md:mb-12 welcome-banner rounded-xl p-8 shadow-lg flex items-center justify-between relative overflow-hidden text-white">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold mb-2">
                    ã“ã‚“ã«ã¡ã¯ã€ <span class="bg-gradient-to-r from-sky-300 to-blue-300 text-transparent bg-clip-text animate-pulse">{{ user.username }}ã•ã‚“ï¼</span>
                </h1>
                <p class="text-slate-100 text-lg">ã‚ã‚„ã¨ä¸€ç·’ã«ã€ä»Šæ—¥ã®äºˆå®šã‚‚ãƒãƒƒãƒãƒªç®¡ç†ã—ã‚ˆã†ï¼</p>
            </div>
            <img alt="AIã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã€Œã‚ã‚„ã€" class="w-24 h-24 md:w-32 md:h-32 absolute right-4 bottom-0 opacity-90 -mb-4 rounded-full shadow-lg ai-avatar-float object-cover object-[center_30%]" src="https://cdn1.genspark.ai/user-upload-image/gpt_image_generated/8b492264-1196-48bb-adc2-30a8453b7770_wm" />
        </section>

        {# --- ãƒ¡ã‚¤ãƒ³ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- #}
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8 dashboard-container"> 

            {# --- æœˆé–“ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ (lgã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã§ã¯2åˆ—åˆ†å æœ‰) --- #}
            <section id="dashboard-calendar-container" class="bg-white p-4 sm:p-6 rounded-xl shadow-lg lg:col-span-2 card-item">
                {# --- âœ¨ ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆï¼ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ ã—ã¦ã€æœˆç§»å‹•ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚ˆï¼ --- #}
                <div class="flex justify-between items-center mb-4">
                    <button data-cal-nav="prev" class="p-2 rounded-full hover:bg-slate-100 text-slate-600" title="å‰ã®æœˆ">
                        <span class="material-symbols-outlined">arrow_back_ios_new</span>
                    </button>
                    <h2 class="text-lg sm:text-xl font-bold text-slate-800">{{ current_year }}å¹´ {{ current_month }}æœˆ</h2>
                    <button data-cal-nav="next" class="p-2 rounded-full hover:bg-slate-100 text-slate-600" title="æ¬¡ã®æœˆ">
                        <span class="material-symbols-outlined">arrow_forward_ios</span>
                    </button>
                </div>
                
                <div id="calendar-goes-here">
                    {{ calendar_html|safe }} {# Pythonãƒ“ãƒ¥ãƒ¼ã‹ã‚‰æ¸¡ã•ã‚ŒãŸã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼HTMLã‚’è¡¨ç¤º #}
                </div>
                <div class="mt-4 text-center">
                    <a href="{% url 'calendar_app:monthly_calendar_today' %}" class="text-sm font-medium text-blue-600 hover:text-blue-700 transition-colors">
                        ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å…¨ä½“ã‚’è¦‹ã‚‹ â†’
                    </a>
                </div>
            </section>

            {# --- å³å´ã‚«ãƒ©ãƒ  (æ—¥ä»˜ã”ã¨ã®äºˆå®šä¸€è¦§ã€AIç´¹ä»‹ã€ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ³ã‚¯) --- #}
            <div class="lg:col-span-1 grid grid-cols-1 gap-6 md:gap-8">
                {# --- æ—¥ä»˜ã”ã¨ã®äºˆå®šä¸€è¦§è¡¨ç¤ºã‚¨ãƒªã‚¢ --- #}
                <section id="daily-schedule-display" class="bg-white p-4 sm:p-6 rounded-xl shadow-lg card-item">
                    <h3 class="text-xl font-semibold text-slate-700 mb-4">
                        {# --- âœ¨ ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆï¼ ã“ã®spanã®ä¸­èº«ã‚’JSã§æ›¸ãæ›ãˆã‚‹ã‚ˆï¼ --- #}
                        <span id="selected-date-display">ä»Šæ—¥</span>ã®äºˆå®š
                        <a href="{% url 'calendar_app:schedule_new' %}" class="float-right flex items-center gap-1 text-xs font-medium text-blue-600 hover:text-blue-700 transition-colors" title="æ–°ã—ã„äºˆå®šã‚’è¿½åŠ ">
                            <span class="material-symbols-outlined text-base">add_circle</span>
                            è¿½åŠ 
                        </a>
                    </h3>
                    <div id="schedule-list-for-date" class="space-y-3 daily-schedule-list">
                        {# --- âœ¨ ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆï¼ åˆæœŸè¡¨ç¤ºã¯JSã«ä»»ã›ã‚‹ã®ã§ã€ã“ã“ã¯ã„ã£ãŸã‚“ç©ºã£ã½ã«ï¼ --- #}
                    </div>
                </section>

                {# --- AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆç´¹ä»‹ (å¤‰æ›´ãªã—) --- #}
                <section class="bg-white p-6 rounded-xl shadow-lg flex flex-col items-center text-center card-item">
                    <img alt="AIã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã€Œã‚ã‚„ã€" 
                         class="w-32 h-32 md:w-40 md:h-40 rounded-full mb-4 border-4 border-pink-300 shadow-md ai-avatar-float object-cover object-[center_30%]" 
                         src="https://cdn1.genspark.ai/user-upload-image/gpt_image_generated/8b492264-1196-48bb-adc2-30a8453b7770_wm"/>
                    <h2 class="text-xl font-semibold text-slate-700 mb-1">ã‚ã‚„ã¨ãŠè©±ã—ã—ã‚ˆã†ï¼</h2>
                    <p class="text-xs text-pink-600 font-medium mb-2">ã‚ãªãŸã®å°‚å±ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆï¼</p>
                     <a href="{% url 'ai_assistant_app:ai_chat' character_id=1 %}" {# ä»®ã§ã‚­ãƒ£ãƒ©ID1ã«ãƒªãƒ³ã‚¯ #}
                        class="w-full mt-4 flex items-center justify-center gap-2 
                               bg-pink-500 hover:bg-pink-600
                               text-white font-semibold py-2.5 px-4 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 ease-in-out transform hover:scale-105 text-sm">
                        <span class="material-symbols-outlined text-base">chat_bubble</span>
                        ã‚ã‚„ã¨ãƒãƒ£ãƒƒãƒˆ
                    </a>
                </section>

                {# --- ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ³ã‚¯ (å¤‰æ›´ãªã—) --- #}
                <section class="bg-white p-6 rounded-xl shadow-lg card-item">
                    <h2 class="text-xl font-semibold text-slate-700 mb-4">ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ³ã‚¯</h2>
                    <div class="grid grid-cols-2 gap-3">
                        <a class="quick-link-card group flex flex-col items-center justify-center p-3 bg-slate-100 hover:bg-sky-100 rounded-lg transition-all duration-200 ease-in-out text-xs sm:text-sm" href="{% url 'calendar_app:monthly_calendar_today' %}">
                            <span class="material-symbols-outlined text-2xl sm:text-3xl text-sky-500 group-hover:text-sky-600 mb-1 transition-colors">calendar_month</span>
                            <span class="font-medium text-slate-700 group-hover:text-sky-700 transition-colors text-center">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼<br class="hidden sm:inline">å…¨ä½“</span>
                        </a>
                        <a class="quick-link-card group flex flex-col items-center justify-center p-3 bg-slate-100 hover:bg-purple-100 rounded-lg transition-all duration-200 ease-in-out text-xs sm:text-sm" href="{% url 'accounts:friend_list' %}">
                            <span class="material-symbols-outlined text-2xl sm:text-3xl text-purple-500 group-hover:text-purple-600 mb-1 transition-colors">groups</span>
                            <span class="font-medium text-slate-700 group-hover:text-purple-700 transition-colors text-center">å‹é”<br class="hidden sm:inline">ç®¡ç†</span>
                        </a>
                         <a class="quick-link-card group flex flex-col items-center justify-center p-3 bg-slate-100 hover:bg-rose-100 rounded-lg transition-all duration-200 ease-in-out text-xs sm:text-sm" href="{% url 'accounts:logout' %}" onclick="event.preventDefault(); document.getElementById('logout-form-quicklink-dashboard-3').submit();">
                            <span class="material-symbols-outlined text-2xl sm:text-3xl text-rose-500 group-hover:text-rose-600 mb-1 transition-colors">logout</span>
                            <span class="font-medium text-slate-700 group-hover:text-rose-700 transition-colors">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</span>
                        </a>
                        <form id="logout-form-quicklink-dashboard-3" action="{% url 'accounts:logout' %}" method="POST" style="display: none;">
                            {% csrf_token %}
                        </form>
                        <div class="quick-link-card group flex flex-col items-center justify-center p-3 bg-gray-200 rounded-lg text-gray-400 cursor-not-allowed text-xs sm:text-sm" title="è¿‘æ—¥å…¬é–‹äºˆå®šï¼">
                            <span class="material-symbols-outlined text-2xl sm:text-3xl mb-1">construction</span>
                            <span class="font-medium text-center">ãã®ä»–<br class="hidden sm:inline">æ©Ÿèƒ½</span>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>

{# --- âœ¨âœ¨ ã“ã“ã‹ã‚‰ãŒæ–°ã—ã„JavaScriptã ã‚ˆï¼ âœ¨âœ¨ --- #}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // å¿…è¦ãªHTMLè¦ç´ ã‚’ãœã‚“ã¶é›†ã‚ã‚‹ã‚ˆï¼
    const calendarContainer = document.getElementById('calendar-goes-here');
    const scheduleListContainer = document.getElementById('schedule-list-for-date');
    const selectedDateDisplay = document.getElementById('selected-date-display');
    
    // Pythonã‹ã‚‰æ¸¡ã•ã‚ŒãŸæœˆã®äºˆå®šãƒ‡ãƒ¼ã‚¿ã‚’JavaScriptã®é­”æ³•ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ã‚ˆ
    let monthSchedules = [];
    try {
        monthSchedules = JSON.parse('{{ schedules_for_month_json|escapejs }}');
    } catch (e) {
        console.error("æœˆã®äºˆå®šãƒ‡ãƒ¼ã‚¿ã®è§£æã«å¤±æ•—ã—ã¡ã‚ƒã£ãŸâ€¦:", e);
    }

    // ä»Šæ—¥ã®æ—¥ä»˜ã‚’è¦šãˆã¦ãŠãã‚ˆ
    const today = new Date();
    const todayYear = today.getFullYear();
    const todayMonth = today.getMonth() + 1;
    const todayDay = today.getDate();

    // ğŸŒŸ ãƒ¡ã‚¤ãƒ³ã®é­”æ³•ï¼æŒ‡å®šã•ã‚ŒãŸæ—¥ã®äºˆå®šã‚’æç”»ã™ã‚‹é–¢æ•° ğŸŒŸ
    function renderSchedulesForDate(year, month, day) {
        // å¿…è¦ãªè¦ç´ ãŒãªã‹ã£ãŸã‚‰ã€ä½•ã‚‚ã—ãªã„ã§çµ‚äº†ï¼
        if (!scheduleListContainer || !selectedDateDisplay) return;
        
        // ã¾ãšã¯äºˆå®šãƒªã‚¹ãƒˆã‚’ç©ºã£ã½ã«ã™ã‚‹ã‚ˆ
        scheduleListContainer.innerHTML = '';
        
        // ã€Œã€‡æœˆã€‡æ—¥ã€ã®éƒ¨åˆ†ã‚’æ›´æ–°ã™ã‚‹ã‚ˆ
        if (year === todayYear && month === todayMonth && day === todayDay) {
            selectedDateDisplay.textContent = 'ä»Šæ—¥';
        } else {
            selectedDateDisplay.textContent = `${month}æœˆ${day}æ—¥`;
        }

        // æœˆã®äºˆå®šã®ä¸­ã‹ã‚‰ã€ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ—¥ã®äºˆå®šã ã‘ã‚’æ¢ã—å‡ºã™ã‚ˆ
        const schedulesOnDay = monthSchedules.filter(schedule => 
            schedule.year === year && schedule.month === month && schedule.day === day
        );

        // äºˆå®šãŒã‚ã£ãŸã‚‰ã€ãƒªã‚¹ãƒˆã«ã—ã¦è¡¨ç¤ºã™ã‚‹ã‚ˆ
        if (schedulesOnDay.length > 0) {
            const ul = document.createElement('ul');
            ul.className = 'space-y-3';
            schedulesOnDay.forEach(schedule => {
                const li = document.createElement('li');
                li.className = 'schedule-item-card flex items-start gap-3 p-3 border border-slate-100 rounded-md hover:bg-slate-50 transition-all';
                
                // äºˆå®šã®ã‚¿ã‚¤ãƒˆãƒ«ã«åˆã‚ã›ã¦ã‚¢ã‚¤ã‚³ãƒ³ã‚’å¤‰ãˆã¦ã¿ã‚‹ï¼ˆãŠã¾ã‘æ©Ÿèƒ½ï¼ï¼‰
                let iconName = 'event'; // åŸºæœ¬ã¯æ™®é€šã®ã‚¤ãƒ™ãƒ³ãƒˆã‚¢ã‚¤ã‚³ãƒ³
                if (schedule.title.includes('ä»•äº‹') || schedule.title.includes('ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°')) iconName = 'work';
                else if (schedule.title.includes('ãƒ¨ã‚¬') || schedule.title.includes('é‹å‹•')) iconName = 'self_improvement';
                else if (schedule.title.includes('ãƒ©ãƒ³ãƒ') || schedule.title.includes('é£Ÿäº‹')) iconName = 'restaurant';
                else if (schedule.title.includes('ãƒ‡ãƒ¼ãƒˆ') || schedule.title.includes('è¨˜å¿µæ—¥')) iconName = 'favorite'; // ãã‚ƒ///

                // HTMLã‚’çµ„ã¿ç«‹ã¦ã‚‹ã‚ˆï¼
                li.innerHTML = `
                    <div class="p-1.5 bg-blue-100 text-blue-600 rounded-full mt-1 flex-shrink-0">
                        <span class="material-symbols-outlined text-base">${iconName}</span>
                    </div>
                    <div class="flex-grow">
                        <h4 class="font-medium text-slate-700 text-sm">${schedule.title}</h4>
                        <p class="text-xs text-slate-500">${schedule.start_time} - ${schedule.end_time}</p>
                        ${schedule.location ? `<p class="text-xs text-slate-400 flex items-center gap-1 mt-1"><span class="material-symbols-outlined text-xs">location_on</span>${schedule.location}</p>` : ''}
                    </div>
                    <a href="${schedule.detail_url}" class="ml-auto text-blue-500 hover:text-blue-700 text-xs self-center font-medium">è©³ç´°</a>
                `;
                ul.appendChild(li);
            });
            scheduleListContainer.appendChild(ul);
        } else {
            // äºˆå®šãŒãªã‹ã£ãŸã‚‰ã€ã€Œãªã„ã‚ˆãƒ¼ã€ã£ã¦è¡¨ç¤ºã™ã‚‹
            scheduleListContainer.innerHTML = '<div class="text-slate-500 text-sm text-center py-8"><span class="material-symbols-outlined text-4xl text-slate-300 block mx-auto mb-2">event_busy</span><p>ã“ã®æ—¥ã®äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p></div>';
        }
    }

    // ğŸŒŸ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ™‚ã®é­”æ³•ï¼ ğŸŒŸ
    function handleDayClick(event) {
        // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã®ãŒæ—¥ä»˜ãƒã‚¹ã˜ã‚ƒãªã‹ã£ãŸã‚‰ç„¡è¦–ï¼
        const targetCell = event.target.closest('.day-cell');
        if (!targetCell) return;

        // æ—¥ä»˜ãƒã‚¹ã‹ã‚‰å¹´ãƒ»æœˆãƒ»æ—¥ã®æƒ…å ±ã‚’æŠœãå‡ºã™ã‚ˆ
        const year = parseInt(targetCell.dataset.year);
        const month = parseInt(targetCell.dataset.month);
        const day = parseInt(targetCell.dataset.day);

        // ã‚‚ã—æƒ…å ±ãŒå–ã‚Œãªã‹ã£ãŸã‚‰ä½•ã‚‚ã—ãªã„
        if (isNaN(year) || isNaN(month) || isNaN(day)) return;

        // ä»Šã¾ã§é¸æŠã•ã‚Œã¦ãŸãƒã‚¹ã®å°ã‚’æ¶ˆã™
        document.querySelectorAll('#calendar-goes-here .day-cell.ring-2').forEach(div => {
            div.classList.remove('ring-2', 'ring-blue-500', 'ring-inset');
        });
        
        // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒã‚¹ã«æ–°ã—ã„å°ã‚’ã¤ã‘ã‚‹
        targetCell.classList.add('ring-2', 'ring-blue-500', 'ring-inset');
        
        // æœ€å¾Œã«ã€ãã®æ—¥ã®äºˆå®šã‚’è¡¨ç¤ºã™ã‚‹ãƒ¡ã‚¤ãƒ³ã®é­”æ³•ã‚’å‘¼ã³å‡ºã™ï¼
        renderSchedulesForDate(year, month, day);
    }

    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å…¨ä½“ã«ã€Œã‚¯ãƒªãƒƒã‚¯ã‚’å¾…ã¤ã€é­”æ³•ã‚’ã‹ã‘ã‚‹ï¼
    if (calendarContainer) {
        calendarContainer.addEventListener('click', handleDayClick);
        
        // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸæ™‚ã«ã€ä»Šæ—¥ã®äºˆå®šã‚’æœ€åˆã«è¡¨ç¤ºã—ã¦ãŠã
        const currentCalYear = parseInt('{{ current_year }}');
        const currentCalMonth = parseInt('{{ current_month }}');
        
        if (currentCalYear === todayYear && currentCalMonth === todayMonth) {
            // ã‚‚ã—è¡¨ç¤ºã—ã¦ã‚‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒä»Šæœˆã ã£ãŸã‚‰â€¦
            renderSchedulesForDate(todayYear, todayMonth, todayDay);
            // ä»Šæ—¥ã®ãƒã‚¹ã‚’æ¢ã—ã¦ã€è‡ªå‹•ã§ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸçŠ¶æ…‹ã«ã—ã¨ã
            const todayCell = calendarContainer.querySelector(`.day-cell.today-cell`);
            if (todayCell) {
                todayCell.classList.add('ring-2', 'ring-blue-500', 'ring-inset');
            }
        } else {
            // ã‚‚ã—é•ã†æœˆã‚’è¡¨ç¤ºã—ã¦ãŸã‚‰ã€ã€Œã‚¯ãƒªãƒƒã‚¯ã—ã¦ã­ã€ã£ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºã™
            scheduleListContainer.innerHTML = '<div class="text-slate-500 text-sm text-center py-8"><span class="material-symbols-outlined text-4xl text-slate-300 block mx-auto mb-2">touch_app</span><p>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜ã‚’<br>ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</p></div>';
        }
    }
    
    // ğŸŒŸ æœˆç§»å‹•ãƒœã‚¿ãƒ³ã®é­”æ³•ï¼ ğŸŒŸ
    document.querySelectorAll('button[data-cal-nav]').forEach(button => {
        button.addEventListener('click', function() {
            const navDirection = this.dataset.calNav;
            // è¡¨ç¤ºä¸­ã®å¹´æœˆã‚’Pythonã‹ã‚‰å—ã‘å–ã‚‹
            let targetYear = parseInt('{{ current_year }}');
            let targetMonth = parseInt('{{ current_month }}');

            if (navDirection === 'prev') { // ã€Œå‰ã¸ã€ãƒœã‚¿ãƒ³
                targetMonth--;
                if (targetMonth < 1) { targetMonth = 12; targetYear--; }
            } else if (navDirection === 'next') { // ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³
                targetMonth++;
                if (targetMonth > 12) { targetMonth = 1; targetYear++; }
            }
            // è¨ˆç®—ã—ãŸå¹´æœˆã®URLã«ãƒšãƒ¼ã‚¸ã‚’ç§»å‹•ã•ã›ã‚‹ï¼
            window.location.href = `{% url 'dashboard_top_page' %}?year=${targetYear}&month=${targetMonth}`; 
        });
    });
});
</script>
{# --- âœ¨âœ¨ JavaScriptã¯ã“ã“ã¾ã§ï¼ âœ¨âœ¨ --- #}
{% endblock %}