<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {# 各ページのタイトルはここでブロックとして定義しておくよ！ #}
    <title>{% block title %}AIお友達スケジュール{% endblock title %}</title>
    
    {# 全てのページで共通のスタイルをここに書くよ！ #}
    <style>
        body { font-family: sans-serif; margin: 0; background-color: #f0f8ff; display: flex; flex-direction: column; min-height: 100vh; color: #333; }
        
        /* ヘッダー (帯の部分) */
        .header {
            background-color: #337ab7; /* 青系 */
            color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex; /* 横並びにするためにflexboxを使うよ */
            justify-content: space-between; /* 両端寄せ */
            align-items: center; /* 中央揃え */
        }
        .header .logo {
            font-size: 1.8em;
            font-weight: bold;
            text-decoration: none;
            color: white;
        }
        .header .logo:hover {
            text-decoration: none; /* ホバーで下線が出ないように */
        }

        /* ナビゲーションメニュー */
        .header-nav {
            display: flex;
            align-items: center;
        }
        .header-nav a {
            color: white;
            text-decoration: none;
            font-weight: bold;
            margin-left: 20px; /* 各リンクの間隔 */
            padding: 5px 0;
            transition: color 0.2s ease;
        }
        .header-nav a:hover {
            color: #d9edf7; /* ホバーで少し明るく */
        }
        .header-nav .logout-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            margin-left: 20px;
            padding: 5px 0;
            transition: color 0.2s ease;
        }
        .header-nav .logout-btn:hover {
            color: #d9edf7;
        }

        /* 通知バー (ヘッダーの下に表示) */
        .notification-bar {
            text-align: right;
            padding: 5px 10px;
            background-color: #e9f5e9; /* 薄い緑 */
            border-bottom: 1px solid #c8e6c9;
            box-shadow: inset 0 -1px 3px rgba(0,0,0,0.05); /* 影で少し浮き上がらせる */
        }
        .notification-bar a {
            text-decoration: none;
            color: #388e3c; /* 濃い緑 */
            font-weight: bold;
            font-size: 0.9em;
        }
        .notification-bar .unread-count {
            background-color: red;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7em;
            margin-left: 3px;
            display: inline-block;
            line-height: 1;
            min-width: 10px;
            text-align: center;
        }

        /* 各ページのコンテンツ部分の基本スタイル */
        .content-wrapper {
            flex-grow: 1; /* コンテンツ部分が縦方向に広がるように */
            padding: 20px;
            max-width: 900px; /* 最大幅を設定 */
            margin: 20px auto; /* 中央寄せ */
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        h1 { /* 各ページの見出し */
            text-align: center;
            color: #4CAF50;
            margin-bottom: 25px;
        }

        /* メッセージ表示 (Django messages framework用) */
        .messages {
            list-style-type: none;
            padding: 0;
            margin: 0 0 20px 0;
        }
        .messages li {
            padding: 12px 20px;
            margin-bottom: 10px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            text-align: center;
            opacity: 0.95;
            transition: opacity 0.3s ease;
        }
        .messages li.success { background-color: #5cb85c; } /* 緑 */
        .messages li.info { background-color: #5bc0de; } /* 水色 */
        .messages li.warning { background-color: #f0ad4e; } /* オレンジ */
        .messages li.error { background-color: #d9534f; } /* 赤 */
        .messages li:hover { opacity: 1; } /* ホバーで透明度を元に戻す */


        /* フォームの共通スタイル (汎用的なもの) */
        form p { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="email"], input[type="password"], input[type="datetime-local"], textarea, select {
            width: calc(100% - 22px); /* paddingとborderを考慮 */
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box; /* これ重要！ */
        }
        textarea { resize: vertical; min-height: 80px; }
        .helptext { font-size: 0.8em; color: #777; margin-top: 2px; margin-bottom: 10px; display: block; }
        ul.errorlist { list-style-type: none; padding: 0; color: red; font-size: 0.9em; margin-top: -10px; margin-bottom: 10px; }
        button[type="submit"] {
            background-color: #5cb85c; color: white; padding: 10px 15px; border: none;
            border-radius: 4px; cursor: pointer; font-size: 1em; width: 100%;
            margin-top: 10px;
        }
        button[type="submit"]:hover { background-color: #4cae4c; }
        .cancel-link { text-align: center; margin-top: 15px; }
        .cancel-link a { color: #777; text-decoration: none; }
        .cancel-link a:hover { text-decoration: underline; }

        /* フッター */
        .footer {
            text-align: center;
            padding: 15px;
            margin-top: auto; /* これでフッターが一番下に固定されるよ！ */
            color: #777;
            font-size: 0.9em;
            border-top: 1px solid #eee;
            background-color: #f8f8f8;
        }
    </style>
</head>
<body>
    {# 帯状のヘッダー部分だよ！ #}
    <header class="header">
        <a href="{% url 'main_app:top_page' %}" class="logo">AIお友達スケジュール</a>
        <nav class="header-nav">
            {% if user.is_authenticated %}
                <a href="{% url 'calendar_app:monthly_calendar_today' %}">📅 カレンダー</a>
                <a href="{% url 'accounts:friend_list' %}">🧑‍🤝‍🧑 友達</a>
                <a href="{% url 'groups_app:group_list' %}">👥 グループ</a>
                <a href="{% url 'ai_assistant_app:ai_chat' 1 %}">💬 AIチャット</a> {# AIキャラID=1(あや)に直行 #}
                <a href="{% url 'accounts:profile' %}">👤 プロフィール</a>
                {# お知らせは通知バーにもあるけど、ここにもリンクしておくと分かりやすいかも #}
                <a href="{% url 'notifications_app:notification_list' %}">🔔 お知らせ
                    {% if unread_notifications_count > 0 %}
                        <span class="unread-count">{{ unread_notifications_count }}</span>
                    {% endif %}
                </a>
                <form method="post" action="{% url 'accounts:logout' %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="logout-btn">ログアウト</button>
                </form>
            {% else %}
                <a href="{% url 'accounts:login' %}">ログイン</a>
                <a href="{% url 'accounts:signup' %}">新規登録</a>
            {% endif %}
        </nav>
    </header>

    {# ログインしている場合は、通知バーをヘッダーの下に表示するよ！ #}
    {% if user.is_authenticated %}
        <div class="notification-bar">
            <a href="{% url 'notifications_app:notification_list' %}">
                <span role="img" aria-label="お知らせ">🔔</span> お知らせ
                {% if unread_notifications_count > 0 %}
                    <span class="unread-count">{{ unread_notifications_count }}</span>
                {% else %}
                    <span style="font-size: 0.8em; color: #777;"> (0)</span>
                {% endif %}
            </a>
        </div>
    {% endif %}

    {# Django messages framework のメッセージを共通で表示する場所 #}
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>
                    {{ message }}
                </li>
            {% endfor %}
        </ul>
    {% endif %}

    {# 各ページのコンテンツは、ここで 'content-wrapper' というクラスで囲むよ！ #}
    {# このブロックの中に、各ページの固有のHTMLコンテンツが入るよ！ #}
    <div class="content-wrapper">
        {% block content %}
        {# ここに各ページの個別コンテンツが挿入されるよ！ #}
        {% endblock content %}
    </div>

    {# 全てのページで共通のフッターだよ！ #}
    <footer class="footer">
        © 2025 AIお友達スケジュール. All rights reserved.
    </footer>
</body>
</html>