{% extends "main_app/base.html" %}
{% load static %}

{% block title %}{% if form.instance.pk %}予定の編集{% else %}新しい予定の作成{% endif %}{% endblock %}
{% block page_title_in_header %}{% if form.instance.pk %}予定の編集{% else %}新しい予定の作成{% endif %}{% endblock %}

{% block content %}
<main class="flex-1 p-6 lg:p-10">
    <div class="max-w-3xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">{% if form.instance.pk %}予定の編集{% else %}新しい予定の作成{% endif %}</h1>
        <div class="bg-white p-8 rounded-xl shadow-xl">
            <form class="space-y-6" method="post">
                {% csrf_token %}

                <div>
                    <label class="flex items-center text-sm font-medium text-gray-700 mb-1" for="{{ form.title.id_for_label }}">
                        <span class="material-symbols-outlined text-lg mr-2 text-gray-500">title</span>
                        タイトル
                    </label>
                    <input class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm h-12 px-4" id="{{ form.title.id_for_label }}" name="{{ form.title.html_name }}" placeholder="例：チームミーティング" type="text" value="{{ form.title.value|default_if_none:'' }}">
                    {% for error in form.title.errors %}<p class="text-red-500 text-xs mt-1">{{ error }}</p>{% endfor %}
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="flex items-center text-sm font-medium text-gray-700 mb-1" for="{{ form.start_datetime.id_for_label }}">
                            <span class="material-symbols-outlined text-lg mr-2 text-gray-500">schedule</span>
                            開始日時
                        </label>
                        <input class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm h-12 px-4" id="{{ form.start_datetime.id_for_label }}" name="{{ form.start_datetime.html_name }}" type="datetime-local" value="{{ form.start_datetime.value|date:'Y-m-d\\TH:i' }}">
                        {% for error in form.start_datetime.errors %}<p class="text-red-500 text-xs mt-1">{{ error }}</p>{% endfor %}
                    </div>
                    <div>
                        <label class="flex items-center text-sm font-medium text-gray-700 mb-1" for="{{ form.end_datetime.id_for_label }}">
                            <span class="material-symbols-outlined text-lg mr-2 text-gray-500">update</span>
                            終了日時
                        </label>
                        <input class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm h-12 px-4" id="{{ form.end_datetime.id_for_label }}" name="{{ form.end_datetime.html_name }}" type="datetime-local" value="{{ form.end_datetime.value|date:'Y-m-d\\TH:i' }}">
                        {% for error in form.end_datetime.errors %}<p class="text-red-500 text-xs mt-1">{{ error }}</p>{% endfor %}
                    </div>
                </div>
                 {% for error in form.non_field_errors %}<p class="text-red-500 text-sm text-center">{{ error }}</p>{% endfor %}

                <div>
                    <label class="flex items-center text-sm font-medium text-gray-700 mb-1" for="{{ form.location.id_for_label }}">
                        <span class="material-symbols-outlined text-lg mr-2 text-gray-500">location_on</span>
                        場所 (任意)
                    </label>
                    <input class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm h-12 px-4" id="{{ form.location.id_for_label }}" name="{{ form.location.html_name }}" placeholder="例：第一会議室" type="text" value="{{ form.location.value|default_if_none:'' }}">
                </div>

                <div>
                    <label class="flex items-center text-sm font-medium text-gray-700 mb-1" for="{{ form.description.id_for_label }}">
                        <span class="material-symbols-outlined text-lg mr-2 text-gray-500">description</span>
                        詳細
                    </label>
                    <textarea class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-4" id="{{ form.description.id_for_label }}" name="{{ form.description.html_name }}" placeholder="予定の詳細を入力..." rows="4">{{ form.description.value|default_if_none:'' }}</textarea>
                </div>

                <div>
                    <label class="flex items-center text-sm font-medium text-gray-700 mb-1" for="{{ form.participants.id_for_label }}">
                        <span class="material-symbols-outlined text-lg mr-2 text-gray-500">groups</span>
                        参加者
                    </label>
                    <select class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-4" id="{{ form.participants.id_for_label }}" multiple name="{{ form.participants.html_name }}">
                        {% for value, text in form.participants.field.choices %}
                            <option value="{{ value }}" {% if value in form.participants.value %}selected{% endif %}>{{ text }}</option>
                        {% endfor %}
                    </select>
                    <p class="mt-1 text-xs text-gray-500">Ctrl/Cmdキーを押しながらクリックすると、複数人選択できます。</p>
                </div>

                <div class="flex justify-end space-x-3 pt-4 border-t border-gray-100">
                    <a href="{{ request.META.HTTP_REFERER|default:_('dashboard_top_page') }}" class="px-6 py-3 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors">
                        キャンセル
                    </a>
                    <button class="px-6 py-3 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-500 hover:bg-blue-600 transition-colors" type="submit">
                        {% if form.instance.pk %}保存する{% else %}作成する{% endif %}
                    </button>
                </div>
            </form>
        </div>
    </div>
</main>
{% endblock %}