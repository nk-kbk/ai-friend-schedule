{% extends "main_app/base.html" %}
{% load static %}

{% block title %}友達を探す - AIフレンドスケジュール{% endblock %}

{% block head_extra_css %}
<style>
    /* このページ固有のスタイルはここに書くとbase.htmlに読み込まれるよ！ */
    .material-icons-outlined {
      font-size: 24px;
    }
    .search-card-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.07);
    }
</style>
{% endblock %}

{% block content %}
<div class="p-6 md:p-10">
    <div class="mx-auto max-w-4xl">
        <h1 class="text-2xl md:text-3xl font-bold text-slate-800 mb-6">友達を探す</h1>

        {# --- 検索フォーム --- #}
        <form method="get" action="{% url 'accounts:user_search' %}" class="relative mb-6">
            <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4 text-slate-500">
                <span class="material-icons-outlined">search</span>
            </div>
            <input name="q" value="{{ query|default:'' }}" class="form-input w-full rounded-xl border-slate-300 bg-white py-3 pl-12 pr-4 text-slate-900 placeholder-slate-400 shadow-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500/50" placeholder="ユーザー名で検索" type="search"/>
            {# 検索ボタンはなくてもEnterで動作するけど、明示的に置いてもいいね！ #}
        </form>
        
        {# --- メッセージ表示 (例:「申請を送りました」) --- #}
        {% if messages %}
            <div class="mb-4">
            {% for message in messages %}
                {# base.html でメッセージ表示はしてるけど、もしこの位置に出したい場合はここを使う #}
                <div class="p-4 text-sm rounded-lg
                    {% if message.tags == 'success' %}bg-green-100 text-green-800{% endif %}
                    {% if message.tags == 'warning' %}bg-yellow-100 text-yellow-800{% endif %}
                    {% if message.tags == 'error' %}bg-red-100 text-red-800{% endif %}
                ">{{ message }}</div>
            {% endfor %}
            </div>
        {% endif %}
        
        {# --- 検索結果表示 --- #}
        <section>
            <h3 class="text-slate-800 text-xl font-semibold leading-tight tracking-tight mb-4">
              検索結果
            </h3>
            
            {% if users_list %}
                <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
                    {% for u in users_list %}
                        <div class="search-card-item flex flex-col items-center gap-4 rounded-xl border border-slate-200 bg-white p-6 shadow-sm transition-all duration-200 ease-in-out">
                            {# プロフィール画像 (仮) #}
                            <div class="bg-slate-200 text-slate-500 flex items-center justify-center font-bold text-2xl aspect-square rounded-full size-20">
                                {{ u.username.0|upper }}
                            </div>
                            <div class="text-center">
                                <p class="text-slate-900 text-lg font-medium leading-normal">
                                    {{ u.username }}
                                </p>
                                <p class="text-slate-500 text-sm font-normal leading-normal">
                                    {{ u.email }}
                                </p>
                            </div>
                            
                            {# --- 友達申請ボタンのロジック --- #}
                            <form method="post" action="{% url 'accounts:send_friend_request' u.id %}" class="w-full">
                                {% csrf_token %}
                                {# ここで、すでに申請済みか、友達かによってボタンを出し分けるともっと親切！ #}
                                {# 今はシンプルな申請ボタンだけにするね！ #}
                                <button type="submit" class="flex w-full items-center justify-center rounded-lg h-10 px-4 bg-blue-600 text-white text-sm font-medium leading-normal shadow-sm hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                    <span class="material-icons-outlined mr-2 text-base">person_add</span>
                                    友達申請を送る
                                </button>
                            </form>
                        </div>
                    {% endfor %}
                </div>
            {% elif query %}
                {# --- 検索結果がなかった場合 --- #}
                <div class="mt-8 flex items-center justify-center">
                    <div class="flex flex-col items-center gap-4 rounded-xl border border-dashed border-slate-300 bg-white p-8 text-center">
                        <span class="material-icons-outlined text-5xl text-slate-400">search_off</span>
                        <p class="text-slate-700 text-lg font-medium">
                          「{{ query }}」に一致するユーザーは見つかりませんでした。
                        </p>
                        <p class="text-slate-500 text-sm">
                          検索キーワードを変えるか、スペルを確認してください。
                        </p>
                    </div>
                </div>
            {% else %}
                 {# --- まだ何も検索していない場合 --- #}
                 <div class="mt-8 flex items-center justify-center">
                    <div class="flex flex-col items-center justify-center gap-4 rounded-xl border border-dashed border-slate-300 bg-white p-8 text-center">
                        <span class="material-icons-outlined text-5xl text-slate-400">person_search</span>
                        <p class="text-slate-700 text-lg font-medium">
                          友達を探してみよう！
                        </p>
                        <p class="text-slate-500 text-sm">
                          上の検索ボックスに友達のユーザー名を入力して検索してください。
                        </p>
                    </div>
                </div>
            {% endif %}
        </section>
    </div>
</div>
{% endblock %}